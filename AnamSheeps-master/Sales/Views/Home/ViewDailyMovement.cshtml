@model SalesModel.ViewModels.ModelDailyMovement
@{
    ViewData["Title"] = "عرض البيان اليومي";
    var isReadOnly = ViewBag.IsReadOnly ?? false;
}

<style>
    .table td,
    .table th {
        padding: 12px 16px !important;
    }

    .table.table-row-bordered > :not(caption) > * > * {
        padding: 14px 18px !important;
    }

    .table thead th {
        padding-top: 14px !important;
        padding-bottom: 14px !important;
        font-size: 15px;
    }

    .table tbody td {
        vertical-align: middle !important;
        font-size: 15px;
    }

</style>

<div class="d-flex flex-column flex-column-fluid">
    <div id="kt_app_content" class="app-content flex-column-fluid">
        <div id="kt_app_content_container" class="app-container container-fluid">

            <!--begin::Page header-->
            <div class="card mb-5">
                <div class="card-body">
                    <div class="d-flex flex-column flex-lg-row align-items-start align-items-lg-center justify-content-between gap-6">

                        <!-- العنوان والمعلومات -->
                        <div class="d-flex flex-column flex-grow-1">
                            <div class="d-flex align-items-center mb-2">
                                <i class="ki-duotone ki-document text-primary fs-2x me-3">
                                    <span class="path1"></span>
                                    <span class="path2"></span>
                                    <span class="path3"></span>
                                </i>
                                <div>
                                    <h1 class="text-dark fw-bold fs-2 mb-1">البيان اليومي</h1>
                                    <div class="text-muted fs-6">عرض تفاصيل الحركة اليومية</div>
                                </div>
                            </div>

                            <div class="d-flex flex-wrap gap-4 mt-3">
                                <div class="d-flex align-items-center text-muted fs-7">
                                    <i class="ki-duotone ki-profile-user text-primary fs-5 me-2">
                                        <span class="path1"></span>
                                        <span class="path2"></span>
                                    </i>
                                    <span class="fw-semibold">المندوب:</span>
                                    <span class="text-dark fw-bold ms-1">@ViewBag.UserName</span>
                                </div>

                                <div class="d-flex align-items-center text-muted fs-7">
                                    <i class="ki-duotone ki-calendar text-primary fs-5 me-2">
                                        <span class="path1"></span>
                                        <span class="path2"></span>
                                    </i>
                                    <span class="fw-semibold">التاريخ:</span>
                                    <span class="text-dark fw-bold ms-1">@Model.DailyMovement_Date.ToString("yyyy-MM-dd")</span>
                                </div>
                            </div>
                        </div>

                        <!-- عناصر التحكم -->
                        <div class="d-flex flex-column flex-sm-row align-items-start align-items-sm-center gap-4">

                            <!-- اختيار التاريخ -->
                            <div class="d-flex align-items-center gap-3 bg-light rounded p-3">
                                <div>
                                    <label class="form-label fs-7 text-muted mb-1">اختر التاريخ</label>
                                    <form method="get" action="@Url.Action("PreviousDailyMovement", "Home")" class="m-0">
                                        <input type="date" name="date"
                                               class="form-control form-control-solid"
                                               value="@Model.DailyMovement_Date.ToString("yyyy-MM-dd")"
                                               onchange="this.form.submit()"
                                               style="min-width: 150px;" />
                                    </form>
                                </div>
                            </div>

                            <!-- زر الرجوع -->
                            <div class="d-flex flex-column">
                                <a href="@Url.Action("Index", "Home")"
                                   class="btn btn-light-primary btn-lg d-flex align-items-center gap-2 px-4 py-3">
                                    <i class="ki-duotone ki-arrow-right fs-2">
                                        <span class="path1"></span>
                                        <span class="path2"></span>
                                    </i>
                                    <span class="fw-semibold">الرئيسية</span>
                                </a>
                            </div>

                        </div>

                    </div>
                </div>
            </div>
            <!--end::Page header-->   




          @* <!--begin::Summary Cards-->
            <div class="row g-5 mb-5">
                <div class="col-md-3">
                    <div class="card card-flush h-100 bg-primary bg-opacity-10">
                        <div class="card-body text-center">
                            <i class="ki-duotone ki-purchase fs-3x text-primary mb-3">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                            <div class="fs-2hx fw-bold text-primary">@Model.Details.Sum(d => d.DailyMovementDetails_Total).ToString("N2")</div>
                            <div class="fs-6 text-gray-600 fw-semibold">إجمالي المشتريات</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card card-flush h-100 bg-danger bg-opacity-10">
                        <div class="card-body text-center">
                            <i class="ki-duotone ki-bill fs-3x text-danger mb-3">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                            <div class="fs-2hx fw-bold text-danger">@Model.Expenses.Sum(e => e.DailyMovementExpense_Total).ToString("N2")</div>
                            <div class="fs-6 text-gray-600 fw-semibold">إجمالي المصروفات</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card card-flush h-100 bg-success bg-opacity-10">
                        <div class="card-body text-center">
                            <i class="ki-duotone ki-wallet fs-3x text-success mb-3">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                            <div class="fs-2hx fw-bold text-success">@Model.Balances.Sum(b => b.DailyMovementBalance_Amount).ToString("N2")</div>
                            <div class="fs-6 text-gray-600 fw-semibold">الأرصدة</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card card-flush h-100 bg-warning bg-opacity-10">
                        <div class="card-body text-center">
                            <i class="ki-duotone ki-arrows-circle fs-3x text-warning mb-3">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                            <div class="fs-2hx fw-bold text-warning">@Model.Withdrawals.Sum(w => w.DailyMovementWithdrawal_Amount).ToString("N2")</div>
                            <div class="fs-6 text-gray-600 fw-semibold">المسحوبات</div>
                        </div>
                    </div>
                </div>
            </div>
            <!--end::Summary Cards--> *@

            <!--begin::Details-->
            @if (Model.Details.Any())
            {
                <div class="card mb-5">
                    <div class="card-header">
                        <h3 class="card-title">تفاصيل المشتريات</h3>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3">
                                <thead>
                                    <tr class="fw-bold text-muted bg-light">
                                        <th class="min-w-150px">المنتج</th>
                                        <th class="min-w-100px text-center">الكمية</th>
                                        <th class="min-w-100px text-end">السعر</th>
                                        <th class="min-w-100px text-end">الإجمالي</th>
                                        <th class="min-w-120px text-center">نوع الدفع</th>
                                        <th class="min-w-150px">ملاحظات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var detail in Model.Details)
                                    {
                                        <tr>
                                            <td class="text-dark fw-bold">@detail.Product_Name</td>
                                            <td class="text-center fw-bold">
                                                <span class="badge fs-6">@detail.DailyMovementDetails_Quantity</span>
                                            </td>
                                            <td class="text-end fw-bold">@detail.DailyMovementDetails_Price.ToString("N2")</td>
                                            <td class="text-end fw-bold">@detail.DailyMovementDetails_Total.ToString("N2")</td>
                                            <td class="text-center  fw-bold">
                                                <span class="badge fw-bold fs-6">@detail.DailyMovementDetails_PaymentType</span>
                                            </td>
                                            <td class="text-dark fw-bold">@detail.DailyMovementDetails_Notes</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            }
            
            <!--end::Details-->
            
            <!--begin::Details-->
            @if (Model.Sales.Any())
            {
                <div class="card mb-5">
                    <div class="card-header">
                        <h3 class="card-title">تفاصيل المبيعات</h3>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3">
                                <thead>
                                    <tr class="fw-bold text-dark bg-light">
                                        <th class="min-w-150px">المنتج</th>
                                        <th class="min-w-100px text-center">الكمية</th>
                                        <th class="min-w-100px text-end">السعر</th>
                                        <th class="min-w-100px text-end">الإجمالي</th>
                                        <th class="min-w-120px text-center">نوع الدفع</th>
                                        <th class="min-w-150px">ملاحظات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var sale in Model.Sales)
                                    {
                                        <tr>
                                            <td class="text-dark fw-bold">@sale.Product_Name</td>
                                            <td class="text-center fw-bold fs-6">
                                                <span class="badge">@sale.DailyMovementSales_Quantity</span>
                                            </td>
                                            <td class="text-end fw-bold">@sale.DailyMovementSales_Price.ToString("N2")</td>
                                            <td class="text-end fw-bold">@sale.DailyMovementSales_Total.ToString("N2")</td>
                                            <td class="text-center">
                                                <span class="badge fw-bold fs-6">@sale.DailyMovementSales_PaymentType</span>
                                            </td>
                                            <td class="fw-bold">@sale.DailyMovementSales_Notes</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            }
            
            <!--end::Details-->
            
            <!--begin::Expenses-->
            @if (Model.Expenses.Any())
            {
                <div class="card mb-5">
                    <div class="card-header">
                        <h3 class="card-title">المصروفات</h3>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3">
                                <thead>
                                    <tr class="fw-bold text-dark bg-light">
                                        <th class="min-w-150px">بند المصروف</th>
                                        <th class="min-w-100px text-center">الكمية</th>
                                        <th class="min-w-100px text-end">المبلغ</th>
                                        <th class="min-w-100px text-end">الإجمالي</th>
                                        <th class="min-w-200px">ملاحظات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var expense in Model.Expenses)
                                    {
                                        <tr>
                                            <td class="text-dark fw-bold">@expense.ExpenseCategory_Name</td>
                                            <td class="text-center fw-bold fs-6">
                                                <span class="badge">@expense.DailyMovementExpense_Quantity</span>
                                            </td>
                                            <td class="text-end fw-bold">@expense.DailyMovementExpense_Amount.ToString("N2")</td>
                                            <td class="text-end fw-bold">@expense.DailyMovementExpense_Total.ToString("N2")</td>
                                            <td class="fw-bold">@expense.DailyMovementExpense_Notes</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            }
      
            <!--end::Expenses-->
            
            <!--begin::Two Column Section-->
            <div class="row g-5 mb-5">
                <!--begin::Suppliers-->
                @if (Model.Suppliers.Any())
                {
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">الموردين</h3>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-row-bordered align-middle">
                                        <thead>
                                            <tr class="fw-bold text-dark bg-light">
                                                <th>المورد</th>
                                                <th class="text-end">المبلغ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var supplier in Model.Suppliers)
                                            {
                                                <tr>
                                                    <td class="text-dark fw-bold">@supplier.Supplier_Name</td>
                                                    <td class="text-end fw-bold">@supplier.DailyMovementSupplier_Amount.ToString("N2")</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                }
                <!--end::Suppliers-->
                <!--begin::Customers-->
                @if (Model.Customers.Any())
                {
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">العملاء</h3>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-row-bordered align-middle">
                                        <thead>
                                            <tr class="fw-bold text-muted bg-light">
                                                <th class="text-center">العميل</th>
                                                <th class="text-center">المبلغ</th>
                                                <th class="text-center">ملاحظات</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var customer in Model.Customers)
                                            {
                                                <tr>
                                                    <td class="text-center text-dark fw-bold">@customer.Customer_Name</td>
                                                    <td class="text-center fw-bold">@customer.DailyMovementCustomer_Amount.ToString("N2")</td>
                                                    <td class="text-center fw-bold">@customer.DailyMovementCustomer_Notes</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                }
                <!--end::Customers-->
            </div>
            <!--end::Two Column Section-->
            <!--begin::Two Column Section-->
            <div class="row g-5 mb-5">
                <!--begin::Taslim-->
                @if (Model.Taslim.Any())
                {
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">تسليم للإدارة</h3>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-row-bordered align-middle">
                                        <thead>
                                            <tr class="fw-bold text-dark bg-light">
                                                <th>المستلم</th>
                                                <th>المبلغ</th>
                                                <th>الملاحظات</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var taslim in Model.Taslim)
                                            {
                                                <tr>
                                                    <td class="text-dark fw-bold">@taslim.DailyMovementTaslim_Receiver</td>
                                                    <td class="fw-bold">@taslim.DailyMovementTaslim_Amount.ToString("N2")</td>
                                                    <td class="fw-bold">@taslim.DailyMovementTaslim_Notes</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                }
               
                <!--end::Taslim-->

                <!--begin::Warid-->
                @if (Model.Warid.Any())
                {
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">وارد من الإدارة</h3>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-row-bordered align-middle">
                                        <thead>
                                            <tr class="fw-bold text-dark bg-light">
                                                <th>المستلم</th>
                                                <th>المبلغ</th>
                                                <th>الملاحظات</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var warid in Model.Warid)
                                            {
                                                <tr>
                                                    <td class="text-dark fw-bold">@warid.DailyMovementWarid_Receiver</td>
                                                    <td class="fw-bold">@warid.DailyMovementWarid_Amount.ToString("N2")</td>
                                                    <td class="fw-bold">@warid.DailyMovementWarid_Notes</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                }
        
                <!--end::Warid-->
            </div>
            <!--end::Two Column Section-->
            <!--begin::Withdrawals & Balances-->
            <div class="row g-5">
                <!--begin::Withdrawals-->
                @if (Model.Taslim.Any())
                {
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">المسحوبات</h3>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-row-bordered align-middle">
                                        <thead>
                                            <tr class="fw-bold text-muted bg-light">
                                                <th>النوع</th>
                                                <th>المستلم</th>
                                                <th class="text-end">المبلغ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var withdrawal in Model.Taslim)
                                            {
                                                <tr>
                                                    <td><span class="badge">تسليم </span></td>
                                                    <td class="text-dark fw-bold">@withdrawal.DailyMovementTaslim_Receiver</td>
                                                    <td class="text-end fw-bold">@withdrawal.DailyMovementTaslim_Amount.ToString("N2")</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                }
                <!--end::Withdrawals-->

                <!--begin::Balances-->
                @if (Model.Balances.Any())
                {
                    <div class="col-md-6 no-print">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">الأرصدة</h3>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-row-bordered align-middle">
                                        <thead>
                                            <tr class="fw-bold text-dark bg-light">
                                                <th>النوع</th>
                                                <th class="text-end">المبلغ</th>
                                                <th>ملاحظات</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var balance in Model.Balances)
                                            {
                                                <tr>
                                                    <td><span class="badge fw-bold">@balance.DailyMovementBalance_Type</span></td>
                                                    <td class="text-end fw-bold">@balance.DailyMovementBalance_Amount.ToString("N2")</td>
                                                    <td class="text-dark fw-bold">@balance.DailyMovementBalance_Notes</td>
                                                </tr>
                                            }
                                        </tbody>
                                        <tfoot>
                                            @{
                                                decimal correctTotal = 0;

                                                foreach (var balance in Model.Balances)
                                                {
                                                    if (balance.DailyMovementBalance_Type.Contains('+'))
                                                    {
                                                        correctTotal += balance.DailyMovementBalance_Amount;
                                                    }
                                                    else if (balance.DailyMovementBalance_Type.Contains('-'))
                                                    {
                                                        correctTotal -= balance.DailyMovementBalance_Amount;
                                                    }
                                                    else
                                                    {
                                                        if (balance.DailyMovementBalance_Type == "رصيد سابق")
                                                        {
                                                            correctTotal += balance.DailyMovementBalance_Amount;
                                                        }
                                                    }
                                                }

                                                var totalClass = correctTotal >= 0 ? "text-success" : "text-danger";
                                            }
                                            <tr class="fw-bold bg-light">
                                                <td class="text-end">الإجمالي</td>
                                                <td class="text-end fw-bold @totalClass">
                                                    @correctTotal.ToString("N2")
                                                </td>
                                                <td></td>
                                            </tr>
                                        </tfoot>

                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>
                }
                <!--end::Balances-->
            </div>
            <!--end::Withdrawals & Balances-->

        </div>
    </div>
</div>