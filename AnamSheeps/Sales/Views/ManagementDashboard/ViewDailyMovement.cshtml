@using System.Security.Claims
@model SalesModel.ViewModels.ModelDailyMovement
@{
    ViewData["Title"] = "عرض البيان اليومي";
    ViewData["Page"] = "عرض البيان اليومي";
    var isReadOnly = ViewBag.IsReadOnly ?? false;
}

<link rel="stylesheet" href="~/css/ViewDailyMovement.css" media="print" />


<div class="d-flex flex-column flex-column-fluid" id="print-area">
    <div id="kt_app_content" class="app-content flex-column-fluid">
        <div id="kt_app_content_container" class="app-container container-fluid">

            <!--begin::Page header-->
            <div class="card mb-5" >
                
                <div class="card-body d-flex align-items-center justify-content-between py-5">
                    <div>
                        <h1 class="page-heading d-flex flex-column align-items-start mb-0">
                            <span class="text-dark fw-bold fs-1">عرض البيان اليومي</span>
                            <span class="text-dark mt-1 fw-semibold fs-6">المندوب: @ViewBag.UserName</span>
                        </h1>
                        <div class="text-dark mt-2 fs-7">
                            <i class="ki-duotone ki-calendar fs-6 me-1">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                            التاريخ: @Model.DailyMovement_Date.ToString("yyyy-MM-dd")
                        </div>
                    </div>

                    <div class="d-flex gap-2">
                       
                        <!-- زر التعديل -->
                        <a href="@Url.Action("Index", "DailyMovement", new { targetUserId = Model.DailyMovement_UserID, targetDate = Model.DailyMovement_Date })"
                        
                        class="btn btn-warning">
                            <i class="ki-duotone ki-pencil fs-3">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                            تعديل
                        </a>

                        <!-- زر الرجوع -->
                        <a href="@Url.Action("DailyMovementsTracking", "ManagementDashboard", new { date = Model.DailyMovement_Date })"
                           class="btn btn-light-primary">
                            <i class="ki-duotone ki-arrow-right fs-3">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                            رجوع
                        </a>
                    </div>
                </div>
            </div>
            <!--end::Page header-->
          

            <!--begin::Details-->
            @if (Model.Details.Any())
            {
                <div class="card mb-5">
                    <div class="card-header">
                        <h3 class="card-title">تفاصيل المشتريات</h3>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3">
                                <thead>
                                    <tr class="fw-bold text-dark bg-light">
                                        <th class="min-w-150px">المنتج</th>
                                        <th class="min-w-100px text-center">الكمية</th>
                                        <th class="min-w-100px text-end">السعر</th>
                                        <th class="min-w-100px text-end">الإجمالي</th>
                                        <th class="min-w-120px text-center">نوع الدفع</th>
                                        <th class="min-w-150px">ملاحظات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var detail in Model.Details)
                                    {
                                        <tr>
                                            <td class="text-dark fw-bold">@detail.Product_Name</td>
                                            <td class="text-center fw-bold">
                                                <span class="badge fs-6">@detail.DailyMovementDetails_Quantity</span>
                                            </td>
                                            <td class="text-end fw-bold">@detail.DailyMovementDetails_Price.ToString("N2")</td>
                                            <td class="text-end fw-bold">@detail.DailyMovementDetails_Total.ToString("N2")</td>
                                            <td class="text-center fw-bold">
                                                <span class="badge fs-6">@detail.DailyMovementDetails_PaymentType</span>
                                            </td>
                                            <td class="text-dark fw-bold">@detail.DailyMovementDetails_Notes</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            }
            
            <!--end::Details-->
            
            <!--begin::Sales-->
            @if (Model.Sales.Any())
            {
                <div class="card mb-5">
                    <div class="card-header">
                        <h3 class="card-title">تفاصيل المبيعات</h3>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3">
                                <thead>
                                    <tr class="fw-bold text-dark bg-light">
                                        <th class="min-w-150px">المنتج</th>
                                        <th class="min-w-100px text-center">الكمية</th>
                                        <th class="min-w-100px text-end">السعر</th>
                                        <th class="min-w-100px text-end">الإجمالي</th>
                                        <th class="min-w-120px text-center">نوع الدفع</th>
                                        <th class="min-w-150px">ملاحظات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var sale in Model.Sales)
                                    {
                                        <tr>
                                            <td class="text-dark fw-bold">@sale.Product_Name</td>
                                            <td class="text-center fw-bold">
                                                <span class="badge fw-bold fs-6">@sale.DailyMovementSales_Quantity</span>
                                            </td>
                                            <td class="text-end fw-bold">@sale.DailyMovementSales_Price.ToString("N2")</td>
                                            <td class="text-end fw-bold">@sale.DailyMovementSales_Total.ToString("N2")</td>
                                            <td class="text-center fw-bold fs-5">
                                                <span class="badge fw-bold fs-6">@sale.DailyMovementSales_PaymentType</span>
                                            </td>
                                            <td class="fw-bold">@sale.DailyMovementSales_Notes</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            }
            
            <!--end::Sales-->
            
            <!--begin::Expenses-->
            @if (Model.Expenses.Any())
            {
                <div class="card mb-5">
                    <div class="card-header">
                        <h3 class="card-title">المصروفات</h3>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3">
                                <thead>
                                    <tr class="fw-bold text-dark bg-light">
                                        <th class="min-w-150px">بند المصروف</th>
                                        <th class="min-w-100px text-center">الكمية</th>
                                        <th class="min-w-100px text-end">المبلغ</th>
                                        <th class="min-w-100px text-end">الإجمالي</th>
                                        <th class="min-w-200px">ملاحظات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var expense in Model.Expenses)
                                    {
                                        <tr>
                                            <td class="text-dark fw-bold">@expense.DailyMovementExpense_CategoryName</td>
                                            <td class="text-center">
                                                <span class="badge fw-bold fs-5">@expense.DailyMovementExpense_Quantity</span>
                                            </td>
                                            <td class="text-end fw-bold">@expense.DailyMovementExpense_Amount.ToString("N2")</td>
                                            <td class="text-end fw-bold">@expense.DailyMovementExpense_Total.ToString("N2")</td>
                                            <td class="fw-bold">@expense.DailyMovementExpense_Notes</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            }
      
            <!--end::Expenses-->
            
            <!--begin::Two Column Section-->
            <div class="row g-5 mb-5">
                <!--begin::Suppliers-->
                @if (Model.Suppliers.Any())
                {
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">الموردين</h3>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-row-bordered align-middle">
                                        <thead>
                                            <tr class="fw-bold text-dark bg-light">
                                                <th>المورد</th>
                                                <th>المبلغ</th>
                                                <th>طريقة الدفع</th>
                                                <th>الملاحظات</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var supplier in Model.Suppliers)
                                            {
                                                <tr>
                                                    <td class="text-dark fw-bold">@supplier.DailyMovementSupplier_SupplierName</td>
                                                    <td class="fw-bold">@supplier.DailyMovementSupplier_Amount.ToString("N2")</td>
                                                    <td class="fw-bold">@supplier.DailyMovementSupplier_PaymentType</td>
                                                    <td class="fw-bold">@supplier.DailyMovementSupplier_Notes</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                }
                <!--end::Suppliers-->
                <!--begin::Customers-->
                @if (Model.Customers.Any())
                {
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">العملاء</h3>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-row-bordered align-middle">
                                        <thead>
                                            <tr class="fw-bold text-dark bg-light">
                                                <th class="text-center">العميل</th>
                                                <th class="text-center">المبلغ</th>
                                                <th class="text-center">طريقة الدفع</th>
                                                <th class="text-center">ملاحظات</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var customer in Model.Customers)
                                            {
                                                <tr>
                                                    <td class="text-center text-dark fw-bold">@customer.DailyMovementCustomer_CustomerName</td>
                                                    <td class="text-center fw-bold">@customer.DailyMovementCustomer_Amount.ToString("N2")</td>
                                                    <td class="text-center fw-bold">@customer.DailyMovementCustomer_PaymentType</td>
                                                    <td class="text-center fw-bold">@customer.DailyMovementCustomer_Notes</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                }
                <!--end::Customers-->
            </div>
            <!--end::Two Column Section-->
            <!--begin::Two Column Section-->
            <div class="row g-5 mb-5">
                <!--begin::Taslim-->
                @if (Model.Taslim.Any())
                {
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">تسليم للإدارة</h3>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-row-bordered align-middle">
                                        <thead>
                                            <tr class="fw-bold text-dark bg-light">
                                                <th>المستلم</th>
                                                <th>المبلغ</th>
                                                <th>الملاحظات</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var taslim in Model.Taslim)
                                            {
                                                <tr>
                                                    <td class="text-dark fw-bold">@taslim.DailyMovementTaslim_Receiver</td>
                                                    <td class="fw-bold fs-6">@taslim.DailyMovementTaslim_Amount.ToString("N2")</td>
                                                    <td class="fw-bold">@taslim.DailyMovementTaslim_Notes</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                }
               
                <!--end::Taslim-->

                <!--begin::Warid-->
                @if (Model.Warid.Any())
                {
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">وارد من الإدارة</h3>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-row-bordered align-middle">
                                        <thead>
                                            <tr class="fw-bold text-dark bg-light">
                                                <th>المستلم</th>
                                                <th class="">المبلغ</th>
                                                <th class="">الملاحظات</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var warid in Model.Warid)
                                            {
                                                <tr>
                                                    <td class="text-dark fw-bold">@warid.DailyMovementWarid_Receiver</td>
                                                    <td class="fw-bold fs-5">@warid.DailyMovementWarid_Amount.ToString("N2")</td>
                                                    <td class="fw-bold">@warid.DailyMovementWarid_Notes</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                }
        
                <!--end::Warid-->
            </div>
            <!--end::Two Column Section-->
            <!--begin:: Balances-->
            <div class="row g-5">

                <!--begin::Balances-->
                @if (Model.Balances.Any())
                {
                    <div class="col-md-6 no-print">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">الأرصدة</h3>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-row-bordered align-middle">
                                        <thead>
                                            <tr class="fw-bold text-dark bg-light">
                                                <th>النوع</th>
                                                <th class="text-end">المبلغ</th>
                                                <th>ملاحظات</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var balance in Model.Balances)
                                            {
                                                <tr>
                                                    <td><span class="badge fw-bold">@balance.DailyMovementBalance_Type</span></td>
                                                    <td class="text-end fw-bold">@balance.DailyMovementBalance_Amount.ToString("N2")</td>
                                                    <td class="text-dark fw-bold">@balance.DailyMovementBalance_Notes</td>
                                                </tr>
                                            }
                                        </tbody>
                                        <tfoot>
                                            @{
                                                decimal correctTotal = 0;

                                                foreach (var balance in Model.Balances)
                                                {
                                                    if (balance.DailyMovementBalance_Type.Contains('+'))
                                                    {
                                                        correctTotal += balance.DailyMovementBalance_Amount;
                                                    }
                                                    else if (balance.DailyMovementBalance_Type.Contains('-'))
                                                    {
                                                        correctTotal -= balance.DailyMovementBalance_Amount;
                                                    }
                                                    else
                                                    {
                                                        if (balance.DailyMovementBalance_Type == "رصيد سابق")
                                                        {
                                                            correctTotal += balance.DailyMovementBalance_Amount;
                                                        }
                                                    }
                                                }

                                                var totalClass = correctTotal >= 0 ? "text-success" : "text-danger";
                                            }
                                            <tr class="fw-bold bg-light">
                                                <td class="text-end">الإجمالي</td>
                                                <td class="text-end fw-bold @totalClass">
                                                    @correctTotal.ToString("N2")
                                                </td>
                                                <td></td>
                                            </tr>
                                        </tfoot>

                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>
                }
                <!--end::Balances-->
            </div>
            <!--end:: Balances-->

        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/ViewDailyMovement.js"></script>

}
