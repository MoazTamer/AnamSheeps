@model List<SalesModel.ViewModels.UserMovementTracking>
@{
    ViewData["Title"] = "متابعة حركات المستودعات";
    ViewData["Page"] = "متابعة حركات المستودعات";
    var selectedDate = ViewBag.SelectedDate ?? DateTime.Today.ToString("yyyy-MM-dd");
}

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.4.1/css/responsive.dataTables.min.css" />

<div class="d-flex flex-column flex-column-fluid">
    <div id="kt_app_content" class="app-content flex-column-fluid">
        <div id="kt_app_content_container" class="app-container container-fluid">

            <!--begin::Page header-->
            <div class="card mb-5">
                <div class="card-body py-5">
                    <!-- Desktop Layout -->
                    <div class="d-none d-lg-flex align-items-center justify-content-between">
                        <div>
                            <h1 class="page-heading d-flex flex-column align-items-start mb-0">
                                <span class="text-dark fw-bold fs-1">متابعة حركات المستودعات</span>
                                <span class="text-muted mt-1 fw-semibold fs-6">عرض ومتابعة بيانات المستودعات اليومية</span>
                            </h1>
                        </div>

                        <!--begin::Date Filter-->
                        <div class="d-flex align-items-center gap-3">
                            <div class="d-flex align-items-center gap-2 bg-light rounded p-2">
                                <input type="date" id="dateFilter" class="form-control border-0 bg-transparent" value="@selectedDate" />
                                <button type="button" class="btn btn-primary px-4 d-flex align-items-center" onclick="loadTrackingData()">
                                    <i class="ki-duotone ki-search fs-3 me-2 d-none d-sm-inline">
                                        <span class="path1"></span>
                                        <span class="path2"></span>
                                    </i>
                                    <span>بحث</span>
                                </button>
                            </div>

                            <a href="@Url.Action("Index", "Home")"
                               class="btn btn-light-primary">
                                <i class="ki-duotone ki-arrow-right fs-4">
                                    <span class="path1"></span>
                                    <span class="path2"></span>
                                </i>
                                <span class="d-none d-md-inline">رجوع</span>
                            </a>
                        </div>
                        <!--end::Date Filter-->
                    </div>

                    <!-- Mobile Layout -->
                    <div class="d-flex d-lg-none flex-column gap-4">
                        <!-- العنوان -->
                        <div class="text-center">
                            <h1 class="text-dark fw-bold fs-3 mb-2">متابعة حركات المستودعات</h1>
                            <div class="text-muted fs-7">عرض ومتابعة بيانات المستودعات اليومية</div>
                        </div>

                        <!-- البحث -->
                        <div class="d-flex flex-column gap-3">
                            <div class="d-flex gap-2 align-items-stretch">
                                <input type="date" id="dateFilterMobile" class="form-control flex-grow-1 border-primary" value="@selectedDate" style="min-height: 45px;" />
                                <button type="button" class="btn btn-primary px-4 d-flex align-items-center" onclick="loadTrackingData()">
                                    <i class="ki-duotone ki-search fs-3 me-2">
                                        <span class="path1"></span>
                                        <span class="path2"></span>
                                    </i>
                                    <span>بحث</span>
                                </button>
                            </div>
                        </div>

                        <!-- زر الرجوع -->
                        <div class="d-flex justify-content-center">
                            <a href="@Url.Action("Index", "Home")"
                               class="btn btn-light-primary flex-grow-1 d-flex align-items-center justify-content-center">
                                <i class="ki-duotone ki-arrow-right fs-3 me-2">
                                    <span class="path1"></span>
                                    <span class="path2"></span>
                                </i>
                                <span>رجوع</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <!--end::Page header-->
            <!--begin::Summary Cards (Dynamic) -->
            <div class="row g-5 mb-5" id="summaryCards">
                <!-- سيتم تحميلها بالبيانات -->
            </div>
            <!--end::Summary Cards-->
            <!-- Loader -->
            <div id="loader" class="text-center py-10" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">جار التحميل...</span>
                </div>
                <p class="mt-2 text-muted">جار تحميل البيانات...</p>
            </div>

            <!--begin::Movements List-->
            <div class="card">
                <div class="card-header border-0 pt-6">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bold fs-3 mb-1">قائمة أمناء المستودعات</span>
                        <span class="text-muted mt-1 fw-semibold fs-7" id="tableDate">التاريخ: @selectedDate</span>
                    </h3>
                </div>
                <div class="card-body py-4">
                    <div class="table-responsive">
                        <table id="trackingTable" class="table table-hover table-row-bordered table-row-gray-100 align-middle gs-0 gy-3">
                            <thead>
                                <tr class="fw-bold text-muted bg-light">
                                    <th class="min-w-50px">م</th>
                                    <th class="min-w-150px">الاسم</th>
                                    <th class="min-w-120px text-center">نوع المستخدم</th>
                                    <th class="min-w-120px text-center">حالة البيان</th>
                                    <th class="min-w-150px text-center">آخر تحديث</th>
                                    <th class="min-w-100px text-center">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملؤها بالبيانات -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!--end::Movements List-->
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/ar.js"></script>

    <script>
        const pageData = {
            selectedDate: '@selectedDate',
            viewMovementUrl: '@Url.Action("ViewWarehouseMovement", "ManagementDashboard")'
        };
    </script>

    <script src="~/js/WarehouseMovementTracking.js"></script>
}